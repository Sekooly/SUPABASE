var mon_role="";var entete_heroku="https://api.sekooly.com/";var liste_class_avec_fond_mode_nuit=["ma_fenetre","titre_drive","mini_popup","msg_envoye","msg_recu","une_notif"];var mode_nuit_oui_final=recuperer("mode_nuit_oui")==="oui"?"non":"oui";function se_deconnecter(){}function mettre_le_contact_etablissement(){var e=contact_etablissement;if($("#contact_etablissement")[0]){$("#contact_etablissement")[0].href="mailto:"+e;$("#contact_etablissement")[0].innerText=e;stocker("contact_etablissement",e)}if($("#logo_etablissement")[0])$("#logo_etablissement")[0].src="https://sekooly.com/assets/images/"+nom_fichier_logo;if($("#site_etablissement")[0])$("#site_etablissement")[0].href=site_etablissement}function ordonner_JSON(e,t){return e.sort((e,r)=>e[t]>r[t]?1:-1)}window.onbeforeunload=function(){se_deconnecter()};function maintenant(){try{var e=get_resultat(racine_data+"rpc/maintenant"+"?"+apikey);return e}catch(r){console.error("erreur pour trouver la date et l'heure.");maintenant_local()}}function maintenant_local(){return(new Date).toLocaleDateString()+" "+(new Date).toLocaleTimeString()}function maintenant_sans_caracteres_speciaux(){var e=maintenant();var r=new Date(moment(e)._d);r=r.toLocaleDateString()+" "+r.toLocaleTimeString();r=r.replaceAll("/","-");r=r.replaceAll(":","-");return r}function hasher(e){return hex_md5(e)}function supprimer_element_de_la_liste(e,r){var t=e.indexOf(r);while(t>-1){e.splice(t,1);t=e.indexOf(r)}return e}function actualiser(e,r,t,n){url=racine_data+e+"?"+r+"=eq."+t+"&"+apikey;return patch_resultat_asynchrone(url,n)}function rechercher_tout(e,r){table=r?e:'"'+e+'"';url=entete_heroku+convertir_db(racine_data)+"/SELECT * FROM "+table+" "+transformer_en_sql(ordonner(e));return get_resultat_asynchrone(url)}function execute_sql(e,r,t){var n=!t?"/False":"";url=entete_heroku+convertir_db(e)+"/"+r+n;return get_resultat_asynchrone(url)}function rechercher(e,r,t,n,i,a){url=racine_data+e+"?"+r+"=eq."+t+"&"+apikey+ordonner(e);url=n?url+"&select="+n:url;url=i?url+"&limit="+i:url;url=a?url+"&order="+a:url;return get_resultat_asynchrone(url)}async function chercher_lien_script(e){var r=racine_initiale+"Scripts?id_script=eq."+e+"&"+api_initial;return get_resultat_asynchrone(r).then(e=>e[0]["lien_script"])}function rechercher_notifs_prof(e){mes_matieres=JSON.parse(recuperer("mes_matieres"));liste_classes_matieres=liste_classes_matieres=mes_matieres.map(e=>e["ID_URL"]).join(";");liste_classes_matieres=liste_classes_matieres.replaceAll(";",'","');url=racine_data+'Notifs?Id_classe_matiere=in.("'+liste_classes_matieres+'")&'+apikey;url=url+"&order=Horodateur.desc";url=e?url+"&limit="+e:url;return get_resultat_asynchrone(url)}function ordonner(e){if(e==="Classes"){return"&order=cycle.desc,niveau.asc,Classe.asc"}else if(e==="Matieres"){return"&order=Cycle.desc,Classe.asc,Matiere.asc"}else if(e==="Eleves"){return"&order=Cycle.desc,Classe.desc,Identifiant.asc"}else if(e==="Profs"||e==="Administration"){return"&order=Cycle.desc,Identifiant.asc"}else if(e==="Logs"||e==="Visio"){return"&order=id.desc"}else if(e==="Notifs"||e==="Topic"||e==="Coms"||e==="Conversations"){return"&order=Horodateur.desc"}else if(e==="Fichiers"||e==="Rendus"){return"&order=date_publication.desc"}else if(e==="Fichiers_tout"){return"&order=date_effet.asc,heure_effet.asc,id_dossier.asc"}else if(e==="Reponses"){return"&order=id_quiz.asc,id_question.asc,position_reponse.asc"}else{return""}}function transformer_en_sql(e){var r="";if(e){r=e.replace("&","").replace("=",' BY "').replace(".",'" ').replaceAll(",",',"').replaceAll(".",'".').replaceAll("."," ")}return r}function convertir_en_date(e){if(e===null)return moment("30/12/1899 00:00:00","DD/MM/YYYY HH:mm:ss");avec_format=!e.includes("+");if(avec_format){return moment(e,"DD/MM/YYYY HH:mm:ss")}else{return moment(e,"YYYY-MM-DD HH:mm:ss.SSSSZ")}}function reinitialiser_unseul_mdp_datenotif(e,r){e=e==="Profs"?"prof":e.substring(0,5).toLowerCase();lien="rpc/initialiser_"+e;url=racine_data+lien+"?"+apikey+"&limit=2000";return post_resultat_asynchrone(url,{["identifiant_"+e]:r})}function nb_coms(e){lien="rpc/nb_coms";url=racine_data+lien+"?"+apikey+"&limit=2000";data='{"valeur_id_topic":'+e+"}";resultat=post_resultat_synchrone(url,data);return Number(resultat.slice(resultat.indexOf("[")+1,resultat.indexOf("]")))}function post_resultat_synchrone(e,r){var t=new XMLHttpRequest;t.open("POST",e,false);data_json=r;t.setRequestHeader("Content-Type","application/json");t.send(data_json);return t.response}function reinitialiser_mdp_datenotif(){url=racine_data+"rpc/initialiser"+"?"+apikey+"&limit=2000";return post_resultat_asynchrone(url)}function rechercher_contenant_motif(e,r,t,n,i,a,s){if(!t)t="--------------------------------------------------------------------------------------------";url=racine_data+e+"?"+r+"=like.*"+t+"*&"+apikey;url=n?url+"&select="+n:url;url=i?url+"&limit="+i:url;url=a&&s?url+"&order="+a+"."+s:url;return get_resultat_asynchrone(url)}function nouvel_id(e,r){url=racine_data+e+"?select="+r;url=url+"&order="+r+".desc";url=url+"&limit=1";url=url+"&"+apikey;var t=get_resultat(url);t=t.length>0?t[0][r]+1:0;return t}function supprimer(e,r,t){url=racine_data+e+"?"+r+"=eq."+t+"&"+apikey;return delete_resultat_asynchrone(url)}function supprimer_avec_ces_references(e,r){var n="";$.each(r,(e,r)=>{var t=n.length===0?"":"&";n+=t+e+"=eq."+r});url=racine_data+e+"?"+n+"&"+apikey;return delete_resultat_asynchrone(url)}function rechercher_avec_ces_references(e,r,t,n){var i="";$.each(r,(e,r)=>{var t=i.length===0?"":"&";i+=t+e+"=eq."+r});var a=t?"&select="+t.join(","):"";url=racine_data+e+"?"+i+a+"&"+apikey+(n?"&order="+n:"");return get_resultat_asynchrone(url)}function supprimer_initial(e,r,t){url=racine_initiale+e+"?"+r+"=eq."+t+"&"+api_initial;return delete_resultat_asynchrone(url)}function supprimer_tout(e){url=racine_data+e+"?"+apikey;return delete_resultat_asynchrone(url)}function nom_des_champs(e){url=racine_data+"?"+apikey;var r=get_resultat(url);return Object.keys(r["definitions"][e]["properties"])}function renvoyer_resultat(e){if(e===null)return null;var r=Object.keys(e)[0];return e[r]}function retour_promise(e){}function ajouter_un_element(e,r){url=racine_data+e+"?"+apikey;return post_resultat_asynchrone(url,r)}function ajouter_un_element_racine(e,r){url=racine_initiale+e+"?"+api_initial;return post_resultat_asynchrone(url,r)}function envoyer_log(e,r,t,n,i){try{var a=get_resultat("https://ipapi.co/json/");var s=a["ip"];var o=a["city"];var u=a["country_name"];var c=a["latitude"];var _=a["longitude"];var l=a["org"];fin_envoi_log(i,e,t,r,s,c,_,l,u,n,o)}catch(m){console.error(m);var s="";var o="";var u="";var c="";var _="";var l="";fin_envoi_log(i,e,t,r,s,c,_,l,u,n,o)}}async function fin_envoi_log(e,r,t,n,i,a,s,o,u,c,_){var l={Horodateur:maintenant(),Identifiant:r,Type:t,Statut:n,IP:i,Latitude:a,Longitude:s,Operateur:o,Pays:u,Type:c,Ville:_};await ajouter_un_element("Logs",l);if(e){if(recuperer("mes_donnees").length>0){stocker("code_saisie",$("#Code").val());window.location.href="tele-enseignement"}}}function chargement(e){$("#img_chargement")[0].style.display=e?"":"none"}function recuperer_nb_pages_pdf(e){url="https://script.google.com/macros/s/AKfycbw3ASmNiz9CSmjI5tWhUBVSk81x_c-vCqOmwqlIqb5Kz7ejZXoa0QziZ0VzuFs7-D0w/exec?id_fichier="+e;return get_resultat(url)}function stocker(e,r){window.localStorage.setItem(e,r)}function recuperer(e){return window.sessionStorage.getItem(e)||window.localStorage.getItem(e)}function stocker_temp(e,r){window.sessionStorage.setItem(e,r)}function recuperer_temp(e){return window.sessionStorage.getItem(e)}function effacer(e){window.localStorage.removeItem(e);window.sessionStorage.removeItem(e)}function tout_effacer_sauf(t){$.each(localStorage,function(e,r){if(t.indexOf(e)===-1)effacer(e)})}async function switcher_la_maintenance(){var e=await est_en_maintenance();console.log(e);valeur_finale=e==="oui"?"non":"oui";actualiser("Maintenance","id","1",{id:"1",Maintenance:valeur_finale});console.log(valeur_finale);return valeur_finale}async function est_en_maintenance(){return get_resultat_asynchrone(racine_data+"/Maintenance"+"?"+apikey).then(e=>{return e[0]["Maintenance"]})}async function alerte_etablissement(){return get_resultat_asynchrone(racine_data+"/Alerte"+"?id=eq.1&"+apikey).then(e=>{return e[0]["Alerte"]})}function recuperer_alerte_etablissement(){return get_resultat(racine_data+"/Alerte"+"?id=eq.1&"+apikey)[0]["Alerte"]}async function switcher_le_champ(e,r){}function liste_img_extensions(){res=liste_extensions().split(",").map(function(e){if(e){return"img_icone_"+e+".png"}});res=res.filter(e=>e);return res}function texte_liste(e,r){return $(e).map(function(){return $(this).attr(r)}).get().join("\n")}function copier_liste(e,r){res=texte_liste(e,r);var t=$("<textarea>");$("body").append(t);t.val(res).select();document.execCommand("copy");t.remove();afficher_alerte("Copi√© dans votre presse-papiers.");return res}function liste_extensions(){return",txt,bmp,gif,jpeg,jpg,png,svg,pdf,bmp,xlsx,xls,xlsm,ppt,pptx,doc,docx,html,csv,js,rtf,mp4,mp3,wav,youtube,quiz,"}function extension_ok(e){return liste_extensions().includes(","+e.toLowerCase()+",")}function element_DOM(e){return document.getElementById(e)}function nombre_de_rows(e){var r=e.getResponseHeader("content-range");return r?Number(r.split("/")[1]):0}function get_resultat(e){var r=new XMLHttpRequest;r.open("GET",e,false);r.send(null);return JSON.parse(r.responseText)}function get_resultat_initial(e){var r=new XMLHttpRequest;r.open("GET",e,false);r.send();return r.response}function get_resultat_brut(e){var r=new XMLHttpRequest;r.open("GET",e,false);r.send(null);return r.responseText}function get_resultat_asynchrone(e){return $.ajax({type:"GET",url:e}).done(function(e){return e})}function patch_resultat_asynchrone(e,r){return $.ajax({type:"PATCH",url:e,data:r}).done(function(e){return e})}function post_resultat_asynchrone(e,r){return $.ajax({type:"POST",url:e,data:r}).done(function(e){return e})}function delete_resultat_asynchrone(e){return $.ajax({type:"DELETE",url:e}).done(function(e){return e})}function suite_notif(){return"-"+recuperer("identifiant_courant").replace(".","")}function afficher_date(e,r){if(!e)return"";var t=r?"YYYY-MM-DD":e.includes("+")?"YYYY-MM-DD HH:mm:ssZ":"DD/MM/YYYY HH:mm:ss";var n=new Date(moment(e,t));var i={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"};if(r)i={weekday:"long",year:"numeric",month:"long",day:"numeric"};return n.toLocaleDateString("fr-FR",i)}function afficher_date_mois_annee(e,r){var t=r?"YYYY-MM-DD":e.includes("+")?"YYYY-MM-DD HH:mm:ssZ":"DD/MM/YYYY HH:mm:ss";return new Date(moment(e,t)).toLocaleDateString("fr-FR",{year:"numeric",month:"numeric"})}function date_mois_precedent(e,r){return moment(e).subtract(r,"months").endOf("month").format("YYYY-MM-DD HH:mm:ssZ")}function les_12_derniers_mois(e){resultat=[];e=e?e:maintenant();for(i=0;i<=11;i++){resultat.push(afficher_date_mois_annee(date_mois_precedent(e,i)))}return resultat.reverse()}function les_12_derniers_mois_en_semaines(e){derniers_mois=date_mois_precedent(e,11);premiere_date=moment(derniers_mois);derniere_date=moment(e);resultat=[];var r=premiere_date.clone();while(r.add(7,"days").isBefore(derniere_date)){resultat.push(r.clone())}resultat.push(derniere_date);return resultat.map(e=>e.format("YYYY-MM-DD"))}function les_12_derniers_mois_en_intervalles_semaines(e){var t=les_12_derniers_mois_en_semaines(e);var r=t.map(function(e,r){if(t[r+1])return t[r]+" "+t[r+1]});return r.filter(e=>e)}function afficher_date_old(e,r){var t=e.includes("-")?"YYYY-MM-DD":"DD/MM/YYYY HH:mm:ss";var n=moment(e,t).toDate();var i={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"};if(r)i={weekday:"long",year:"numeric",month:"long",day:"numeric"};return n.toLocaleDateString("fr-FR",i)}function transformer_en_array_de_JSON(r){return r===null?[]:Object.keys(r).map(e=>r[e])}var separateur=",";function convertir_csv(e,r){if(typeof e[0]==="string"){return e.join(separateur)}else{var t=garder_les_colonnes_non_automatiques(e);t=[Object.keys(e[0])].concat(t);if(r){return t[0].join(separateur)}return t.map(e=>{return Object.values(e).join(separateur)}).join("\r\n")}}function garder_les_colonnes_non_automatiques(e){e.forEach(function(t,e){parametres_automatiques.map(function(e,r){if(t[e]!==undefined){delete t[e]}})});return e}function csv_en_JSON(e){var i=e.split("\n");var a=i[0].split(separateur);console.log(a);var s=[];i.forEach(function(e,r){if(typeof e==="string")e.split("\n");console.log(e);if(r===0)return true;var t={};for(var n=0;n<a.length;n++){t[a[n]]=i[r].split(separateur)[n]}if(t!=={})s.push(t)});return s}function identifiant_par_table(e){var r=get_resultat(racine_data+"?"+apikey);var t=r["definitions"][e]?r["definitions"][e]["properties"]:{};var n=Object.keys(t);var i=Object.values(t);if(n.length>0&&n.length>0){var a=i.map(e=>e["description"]).indexOf("Note:\nThis is a Primary Key.<pk/>");var s=a>=0?n[a]:""}else{var s=""}return s}function init_mon_role(){mon_role=recuperer("mon_type");if(mon_role!==null&&mon_role!==undefined){mon_role=mon_role.substring(0,mon_role.length-1);if(mon_role.includes("Admin"))mon_role=recuperer("mes_donnees")?JSON.parse(recuperer("mes_donnees"))["Role"]:""}return mon_role}function afficher_clic_droit_param(e){event.preventDefault();event.stopPropagation();id_parametre=$(".un_menu_orange")[0].id||$(".un_menu_orange")[0].value;$("#clic_droit_titres_param").remove();$("thead").append('<div id="clic_droit_titres_param" style="z-index: 50;position: fixed;"></div>');if($(".header_table.entete_sticky:visible").length>1){ajouter_fonction_clic_droit(event,element_DOM("clic_droit_titres_param"),0,"masquer_colonne","Masquer la colonne <b>"+e.id+"</b>",e.id,"clic_droit_titre_param")}liste_params_colonnes_masquees=recuperer("liste_params_colonnes_masquees");liste_params_colonnes_masquees=liste_params_colonnes_masquees?liste_params_colonnes_masquees.split(","):[];liste_params_colonnes_masquees=liste_params_colonnes_masquees.filter(e=>e.includes(id_parametre+":"));if(liste_params_colonnes_masquees.length>0){for(var r=0;r<liste_params_colonnes_masquees.length;r++){parametre=liste_params_colonnes_masquees[r].split(":")[0];id_colonne=liste_params_colonnes_masquees[r].split(":")[1];if(parametre)ajouter_fonction_clic_droit(event,element_DOM("clic_droit_titres_param"),r+1,"afficher_colonne","Afficher <b>"+id_colonne+"</b>",id_colonne,"clic_droit_titre_param")}ajouter_fonction_clic_droit(event,element_DOM("clic_droit_titres_param"),r+1,"afficher_colonnes","<b>Afficher toutes les colonnes</b>",e.id,"clic_droit_titre_param")}$(document).click(function(){$(".clic_droit").remove();$("#clic_droit_titres_param").remove()})}function afficher_colonnes(r,e){$("th").css("display","");$("td").css("display","");r=$(".un_menu_orange")[0].id||$(".un_menu_orange")[0].value;if(e!==""){liste=recuperer("liste_params_colonnes_masquees");if(liste.length>0){liste=liste.split(",");liste=liste.filter(function(e){return e.split(":")[0]!==r})}autoriser_tout_voir(false);stocker("liste_params_colonnes_masquees",liste)}$("#clic_droit_titres_param").remove()}function afficher_colonne(e,r){masquer_colonne(e,true)}function masquer_colonne(e,r){if(e!==""){visibilite=r?"":"none";if($("[id='"+e+"'].header_table.entete_sticky")[0]){$("[id='"+e+"'].header_table.entete_sticky")[0].style.display=visibilite}else{return true}param_actualis√©=($(".un_menu_orange")[0].id||$(".un_menu_orange")[0].value)+":"+e;liste_params_colonnes_masquees=recuperer("liste_params_colonnes_masquees");liste_params_colonnes_masquees=liste_params_colonnes_masquees?liste_params_colonnes_masquees.split(","):[];position_param_actualis√©=$.inArray(param_actualis√©,liste_params_colonnes_masquees);if(visibilite==="none"){autoriser_tout_voir(true);if(position_param_actualis√©===-1)liste_params_colonnes_masquees.push(param_actualis√©)}else{if(position_param_actualis√©!==-1)liste_params_colonnes_masquees.splice(position_param_actualis√©,1)}stocker("liste_params_colonnes_masquees",liste_params_colonnes_masquees);var t=$("[id='"+e+"'].header_table.entete_sticky")[0].cellIndex+1;if(visibilite==="none"){autoriser_tout_voir(true);$("td:nth-child("+t+"),th:nth-child("+t+")").hide()}else{$("td:nth-child("+t+"),th:nth-child("+t+")").show()}}$("#clic_droit_titres_param").remove()}function somme(e,r,t){total=0;numero_colonne_champ_a_sommer=$("[id='"+r+"']")[0].cellIndex+1;les_elements=transformer_en_array_de_JSON($("table tr td:nth-child("+numero_colonne_champ_a_sommer+"):visible"));les_elements.forEach(function(e){var r=parseInt(e.innerText);if(!isNaN(r)){total+=r}});return total}function actualiser_octets(){lien_script="https://script.google.com/macros/s/AKfycbyenqGECCqdKfpvI_y6Anq2_rWmYdIaY9WjT33pUhiA591vpFkmPyJYgDC8gJqVSv8y_w/exec?";espace=JSON.parse(recuperer("Espace etablissement restant"));for(var e=0;e<espace.length-1;e++){id_fichier=espace[e]["ID_FICHIER"];taille_fichier=espace[e]["octets_utilises"];if(id_fichier&&taille_fichier===0){console.log(e+1+" "+id_fichier);taille_fichier=get_resultat_brut(lien_script+"id_fichier="+id_fichier);if(!taille_fichier.includes("ERREUR")){nom_table=espace[e]["SOURCE"];nom_champ_reference="id_fichier";valeur_champ_reference=id_fichier;nouveau_data={taille_fichier:taille_fichier};console.log(taille_fichier+"\n");actualiser(nom_table,nom_champ_reference,valeur_champ_reference,nouveau_data)}}else{console.log("probleme sur le "+e)}}}function config_editor(){config={language:{content:"fr",ui:"fr"},toolbar:{items:["heading","|","bold","italic","fontBackgroundColor","|","bulletedList","numberedList","|","blockQuote","link"]},typing:{tranformations:{include:["symbols","mathematical","typography","quotes"]}}};return config}function inserer_element(t,n){t.model.change(e=>{const r=e.createText(n);t.model.insertContent(r,t.model.document.selection)})}function ordonner_elements(e,i){return $($(e).toArray().sort(function(e,r){var t=parseInt(e.getAttribute(i)),n=parseInt(r.getAttribute(i));return t-n}))}function creer_uuid(){return get_resultat_brut("https://www.uuidgenerator.net/api/version4")}function ajouter_motif(e){return"-"+e+"-"}function create_id_conv(e,r){if(!r){return ajouter_motif(recuperer("identifiant_courant"))+ajouter_motif(e)}else{return r}}function recuperer_destinataire(e){resultat=e.replaceAll(recuperer("identifiant_courant"),"").replaceAll("-","").toUpperCase();if(!resultat)resultat=recuperer("identifiant_courant").toUpperCase();return resultat}function changer_mode(e){est_deja_mode_nuit=recuperer("mode_nuit_oui")==="oui";if(e)est_deja_mode_nuit=!est_deja_mode_nuit;texte_final_mode_nuit_oui=est_deja_mode_nuit?"":" ‚úì";classe_finale_body=est_deja_mode_nuit?"":"dark-mode";mode_nuit_oui_final=est_deja_mode_nuit?"non":"oui";stocker("mode_nuit_oui",mode_nuit_oui_final);if($("#mode_nuit_oui")[0])$("#mode_nuit_oui")[0].innerText=texte_final_mode_nuit_oui;$("body").attr("class",classe_finale_body);var r=mode_nuit_oui_final==="oui"?"night":"day";if($("#mode")[0]){$("#mode")[0].src="https://sekooly.com/assets/images/img_"+r+".png"}}function mettre_mon_mode(){if(location.href.includes("tele-enseignement")){mettre_mon_mode_t_e()}else{changer_mode(true)}}function mettre_mon_mode_t_e(){$('[class="element-pref"] input').attr("name",function(e,r){if(liste_class_avec_fond_mode_nuit.filter(e=>e.includes(r)).length>0){$("[name='"+r+"']").parent().parent().append(night_mode_option())}});configurer_mode();configurer_mode()}function night_mode_option(){return`

    <h5 class="clickable au-centre" onclick="configurer_mode()">
      <img class="mini-image my-vision-mode" alt="üåô" src="https://raw.githubusercontent.com/Sekooly/SUPABASE/main/docs/images/img_night.png" style="">
      Mode <span class="mode-night">nuit</span>
    </h5> 

  `}function configurer_mode(){$('[class="clickable au-centre"]').siblings("h2").children("input").attr("name",function(e,r){if(mode_nuit_oui_final==="non"){return"darkmode-"+r}else if(mode_nuit_oui_final==="oui"){return r.split("darkmode-")[1]}});changer_mode();var r=mode_nuit_oui_final==="oui";mode_night=r?"nuit":"jour";liste_class_avec_fond_mode_nuit.forEach(function(e){e=r?"darkmode-"+e:e;actualiser_class_apres_changement_mode(r,e)});$(".mode-night").text(mode_night);$("#body-color").val(rgb2hex($("body").css("background-color")));liste_class_avec_fond_mode_nuit.map(e=>'input[name*="'+e+'"]').forEach(function(e){var r=$(e).attr("name");if(r){var t=couleur_fond_bis(r);if(t)$(e).val(t)}});var e=r?"night":"day";$(".my-vision-mode").attr("src","https://sekooly.com/assets/images/img_"+e+".png")}function actualiser_class_apres_changement_mode(e,r){class_initiale=r.replaceAll("darkmode-","");classe_a_enlever="darkmode-"+class_initiale;selector_changement="[class*='"+class_initiale+"']";if(e){$(selector_changement).addClass(classe_a_enlever)}else{$(selector_changement).removeClass(classe_a_enlever)}}function modifier_donnee_locale(e,r,t,n,i,a,s){var o=JSON.parse(recuperer(e));if(o[r]&&!a)o=[o];o.forEach(function(e){if(e[r]===t){e[n]=i}});if(s){o=o.sort(s)}if(a){stocker(e,JSON.stringify(o))}else{stocker(e,JSON.stringify(o[0]))}return recuperer(e)}function supprimer_donnee_locale(e,r,t){var n=JSON.parse(recuperer(e));donnees_finales=n.filter(function(e){return e[r]!==t});stocker(e,JSON.stringify(donnees_finales));return recuperer(e)}function tri_ordre_chrono_decroissant_Date_derniere_modif(e,r){return convertir_en_date(r.Date_derniere_modif)-convertir_en_date(e.Date_derniere_modif)}String.prototype.replaceAll=function(e,r){return this.split(e).join(r)};function ajouter_donnee_locale(e,r,t,n){var i=JSON.parse(recuperer(e));if(!i)i=[];if(!i.find(e=>e[t]===r[t])){if(n){i.unshift(r)}else{i.push(r)}}stocker(e,JSON.stringify(i));return recuperer(e)}function la_matiere_chargee(e){if(recuperer("mon_type").includes("Administration_final")&&e==="Classe"&&$("#accueil_utilisateur")[0].innerText.trim().includes("Vie scolaire")){return JSON.parse(recuperer("mes_donnees"))["Cycle"]}else if(!recuperer("mon_type").includes("Administration_bis")){var r=recuperer("dossier_charg√©");var t=JSON.parse(recuperer("mes_matieres"));if(r){var n=t.find(e=>e["ID_URL"]===r);if(n){return n[e]}else{return"classe_matiere_introuvable"}}else{return"classe_matiere_introuvable"}}else{if(e==="Classe")return $("#accueil_utilisateur")[0].innerText.trim()}}function convertir_db(e){return"db."+e.replace("https://","").split("/rest/v1")[0]}async function telecharger_tout(e){if(tous_avec_un_fichier("soumettre_devoir")){var r="";try{r=await domtoimage.toPng($("#tout")[0])}catch(t){r="";afficher_alerte("Impossible de fusionner les fichiers: ils doivent TOUS √™tre des images.")}if(!e)enregistrer_image(r,"devoir-fusionn√©-"+recuperer("identifiant_courant")+".png");return r}else{afficher_alerte("Vous n'avez pas fourni toutes les pages que vous avez demand√© √† ajouter.");return""}}function vider_previz_devoir_rendu(){$("#tout")[0].innerHTML=""}function rassembler(e){var r=$("#soumettre_devoir > input").length;if(tous_avec_un_fichier("soumettre_devoir")){vider_previz_devoir_rendu();for(numero_fichier=0;numero_fichier<r;numero_fichier++){$("#tout").append('<img id="result'+numero_fichier+'">');var t=numero_fichier===0?"":"_"+numero_fichier;var n="file_devoir"+t;if($("#"+n).length>0){readImage($("#"+n)[0].files[0],numero_fichier);if(numero_fichier===r-1)return true}}}else{if(!e)afficher_alerte("Vous n'avez pas fourni toutes les pages que vous avez demand√© √† ajouter.")}}function readImage(e,r){if(e.type&&!e.type.startsWith("image/")){erreur="‚ö†Ô∏è Le fichier n¬∞"+r+" n'est pas une image : il ne pourra ni √™tre pr√©visualis√©, ni √™tre fusionn√© √† d'autres fichiers.";alert(erreur);console.error(erreur,e.type,e);return}const t=new FileReader;t.addEventListener("load",async e=>{le_resultat=$("#result"+r)[0];le_resultat.src=e.target.result;recuperer_dimensions(t,afficher_en_bonnes_dimensions,le_resultat)});t.readAsDataURL(e)}function afficher_en_bonnes_dimensions(e,r){r.width=e[0];r.height=e[1];return e}function recuperer_dimensions(e,r,t){var t=new Image;var n=[];t.onload=function(){n.push(t.width);n.push(t.height);return r(n,t)};t.src=e.result}function tous_avec_un_fichier(e){avec_fichier="";$('[id="'+e+'"]').children("input").each(function(){avec_fichier+=avec_un_fichier(this).toString()});return!avec_fichier.includes("false")}function avec_un_fichier(e){return e.files.length>0}function enregistrer_image(e,r){var t=document.createElement("a");t.download=r;t.href=e;t.click()}function code_ok(e,r){var t=hasher(e["Code"]);var n=hasher(r);var i=e["code_hash"]==="ok"?n===e["Code"]:e["Code"]===r;return i}async function recuperer_mes_donnees(){var e=[];var r=recuperer("mon_type").split("_")[0];e=await rechercher(r,"Identifiant",recuperer("identifiant_courant"));if(e)e=e[0];return e}function compter(e){url=entete_heroku+convertir_db(racine_data)+'/SELECT COUNT(*) as result FROM "'+e+'"';return get_resultat(url)}function taille_fichier_quiz(e){return new Blob([e]).size}function recherche_initiale(e){return get_resultat_asynchrone(racine_initiale+e+"?"+api_initial)}function recherche_initiale_where(e,r,t,n,i,a){url=racine_initiale+e+"?"+r+"=eq."+t+"&"+api_initial;url=n?url+"&select="+n:url;url=i?url+"&limit="+i:url;url=a?url+"&order="+a:url;return get_resultat_asynchrone(url)}function json_to_url(e){var n="";$.each(e,(e,r)=>{var t=n===""?"?":"&";n+=t+e+"="+r});return n}function objectifyForm(e){formArray=$("#"+e).serializeArray();var r={};for(var t=0;t<formArray.length;t++){r[formArray[t]["name"]]=formArray[t]["value"]}return r}function my_ctz(){return encodeURIComponent(Intl.DateTimeFormat().resolvedOptions().timeZone)}function hebergeur_defaut(){return"https://sekooly.com/assets/images"}function hebergeur_actuel(e){return prefixe_image===hebergeur_defaut()?e?hebergeur_defaut():"":prefixe_image}function rgb2hex(e){if(!e)return"#FFFFFF";if(e.includes("rgba")){var r=e.split(",").pop();e=e.replace(","+r,")");e=e.replace("rgba","rgb")}return`#${e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/).slice(1).map(e=>parseInt(e,10).toString(16).padStart(2,"0")).join("")}`}function rgb2hex_bis(e){if(e==="rgba(0, 0, 0, 0)"){return"#FFFFFF"}if(!e)return false;return`#${e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/).slice(1).map(e=>parseInt(e,10).toString(16).padStart(2,"0")).join("")}`}function couleur_texte(e,r){type_tmp=r?e:"h1";class_tmp=r?"":e+" tmp";tmp=document.createElement(type_tmp);tmp.id="tmp_color";tmp.className=class_tmp;$("body").append(tmp);rgb=$(e.split(" ").map(e=>(r?"":".")+e)+".tmp").css("color");$("#"+tmp.id).remove();return rgb2hex(rgb)}function couleur_fond(e,r){type_tmp=r?e:"h1";class_tmp=r?"":e+" tmp";tmp=document.createElement(type_tmp);tmp.id="tmp_color";tmp.className=class_tmp;$("body").append(tmp);rgb=$(e.split(" ").map(e=>(r?"":".")+e)+".tmp").css("background-color");$("#"+tmp.id).remove();return rgb2hex(rgb)}function couleur_fond_bis(e,r){type_tmp=r?e:"h1";class_tmp=r?"":e+" tmp";tmp=document.createElement(type_tmp);tmp.id="tmp_color";tmp.className=class_tmp;$("body").append(tmp);rgb=$(e.split(" ").map(e=>(r?"":".")+e)+".tmp").css("background-color");$("#"+tmp.id).remove();return rgb2hex_bis(rgb)}function appliquer_preferences(){remplacer_image_par_defaut();if(data_etablissement["preferences"]){$.each($("img[src]"),(e,r)=>{the_src=decodeURIComponent(r.src);suffixe=the_src.split(hebergeur_defaut())[1];if(!suffixe)suffixe=the_src.split(hebergeur_actuel())[1];r.src=prefixe_image+suffixe});appliquer_images();appliquer_fond(data_etablissement["preferences"]["background"]);appliquer_couleurs();appliquer_formes()}}function appliquer_fond(e){if(e){$(".sekooly-background").addClass("show");$('img[href="'+prefixe_image+'/img_background-image.png"]').show();$('[id="my-background-image"]').prop("checked",true);data_etablissement["preferences"]["background"]=true}else{$(".sekooly-background").removeClass("show");$('img[href="'+prefixe_image+'/img_background-image.png"]').hide();$('[id="my-background-image"]').prop("checked",false);delete data_etablissement["preferences"]["background"]}mettre_source_background()}function remplacer_image_par_defaut(){const e=$("body")[0];const r={attributes:true,childList:true,subtree:true};const t=function(e,r){for(const t of e){if(t.type==="childList"){}else if(t.type==="attributes"){}}};const n=new MutationObserver(actualiser_image_non_trouvee);n.observe(e,r)}function actualiser_image_non_trouvee(e){$("img").off("error");$("img").on("error",function(e){remplacer_avec_defaut(e)});ajouter_class_dark_mini_popup_si_besoin()}function ajouter_class_dark_mini_popup_si_besoin(){var e=mode_nuit_oui_final==="oui"?" darkmode-mini_popup":"";if(e)$(".mini_popup").addClass("darkmode-mini_popup")}function appliquer_images(){$.each($(".une_image"),(e,t)=>{$.each($("img[src$='"+t.innerText+"']"),(e,r)=>{$(r).one("error",function(e){remplacer_avec_defaut(e)});r.src=t.parentNode.href});if(!data_etablissement["preferences"]){data_etablissement["preferences"]={}}data_etablissement["preferences"]["prefixe_image"]=element_DOM("prefixe_image").value?element_DOM("prefixe_image").value:hebergeur_defaut()});mettre_source_background()}function mettre_source_background(){if(data_etablissement["preferences"]["background"]){element_DOM("background-image").src=prefixe_image+"/img_background-image.png"}}function remplacer_avec_defaut(e){a_changer=e.target.src;if(!a_changer.includes("undefined")){var r=hebergeur_defaut()+"/"+a_changer.split("/").pop();e.target.src=r}}function appliquer_couleurs(){if(data_etablissement["preferences"]&&data_etablissement["preferences"]["couleurs"]){element_DOM("custom-css").innerText=data_etablissement["preferences"]["couleurs"]}}function appliquer_formes(){}function envoyer_mon_statut(e){if(recuperer("mon_type")){var r=recuperer("mon_type").split("_")[0];actualiser(r,"Identifiant",recuperer("identifiant_courant"),{statut:e})}}function verify_local_pass(){var e=recuperer("code_saisie")?recuperer("code_saisie"):"";if(e){var r=recuperer("mon_type").split("_")[0];var t=recuperer("identifiant_courant");var n=get_resultat(racine_data+"rpc/code_ok?mon_type="+r+"&mon_id='"+t+"'&plain_code='"+e+"'"+"&"+apikey);if(!n||n.length<=0){deconnexion();return false}else{effacer("code_saisie");return true}console.log(n)}}